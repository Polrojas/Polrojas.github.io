<!DOCTYPE html>
<html>
<title>Administración del sitio</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<link rel="stylesheet" href="style/style-site.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Patua+One&display=swap" rel="stylesheet">
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="js/bodymin-animation.min.js" type="text/javascript"></script>
<script src="js/bodymovin.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://unpkg.com/@videojs/themes@1/dist/fantasy/index.css" rel="stylesheet">
<link href="video/video-js.css" rel="stylesheet">
<script src="video/video.min.js"></script>
<body>

    <div id="menu-arkidia">
        <menu-arkidia :datamenu="datamenu"></menu-arkidia>
      </div>


    <div id="app" :style="categoriaStyle" >
        <div id="categoria">


    <div style="width: 100%; border-radius:15px; margin-bottom:20px; text-align: -webkit-center;">

                <video
                  id="my-video"
                  class="video-js"
                  controls
                  autoplay
                  preload="auto"
                  poster="admin/images/wait-video.svg"
                  
                  data-setup="{}"
                >
                  <source src="video.mp4" type="video/mp4" />

                  <p class="vjs-no-js">
                    Para ver este video necesitás activar JavaScript
                  </p>
                </video>
              
            </div>

        </div>

    </div>




    


    <script src="js/video.js" type="text/javascript"></script>
    <script src="js/menu-arkidia.js" type="text/javascript"></script>



  <script type="text/javascript">
    var player = videojs('my-video')
    player.width(innerWidth - 20)
    player.src(sessionStorage.video)


    
    function UpdateTime() {
      desde = (sessionStorage.avance / 100) * player.duration()
      avance_actual = 100*(player.currentTime() / player.duration() )

//      if(avance_actual < sessionStorage.avance){
//          player.currentTime(desde)
//      }

      if(avance_actual > sessionStorage.avance){
        grabarAvance(avance_actual)
        if(avance_actual == 100){
          window.location.href = "congrats.html";
        }
      }
    }

    function grabarAvance(avance){
    bodyApi = 	"id_contenido=" + sessionStorage.contenido + 
				"&usuario=" + sessionStorage.loggedUser + 
				"&porcentaje_avance=" + avance 
    fetch("ApiRes/contenido_alumno.php?"+bodyApi, {
              method: 'PUT',
              body: bodyApi,
              headers: new Headers({
            	'Content-Type': 'application/x-www-form-urlencoded'
              })
          })
          .then(function(response) {
              if(response.ok) {
                sessionStorage.avance = avance
              }
              else{
                  throw "Error en la llamada Ajax"
              }
           })
}
window.addEventListener("load",function (){
    const loader = document.querySelector(".loader");
    loader.className += " hidden";
  })
    setInterval( UpdateTime, 2000 );

  </script>
    


</body>
</html>